use cxdb;

select *
into #TempTaskSourceTable
from (
	select 'Ran' as 'State', projectid, taskid, sourceid, enginestartedon, enginefinishedon, serverid from taskscans
	where 
	
		((taskid = 12303 and sourceid = '0000000050_00-319958211_00-374117344') or (taskid = 1246 and sourceid = '0000000098_000551171435_001158411825') or (taskid = 1252 and sourceid = '0000000046_000507160708_000327549968') or (taskid = 12699 and sourceid = '0000004359_001124553559_001027931664') or (taskid = 12771 and sourceid = '0000000053_001647134862_0-1664125545') or (taskid = 1321 and sourceid = '0000000056_0-1857079141_0-2129327925') or (taskid = 13218 and sourceid = '0000000042_00-680051026_0-1368343568') or (taskid = 13219 and sourceid = '0000000096_000555290107_0-1891124284') or (taskid = 13221 and sourceid = '0000000068_001453830513_001200355202') or (taskid = 13267 and sourceid = '0000000150_001492167418_000762586295') or (taskid = 13751 and sourceid = '0000000152_00-155008502_001619270863') or (taskid = 14801 and sourceid = '0000000079_001341859137_0-1607497417') or (taskid = 15671 and sourceid = '0000000067_0-1817521073_00-271722450') or (taskid = 17233 and sourceid = '0000000211_001064708963_00-166701739') or (taskid = 19895 and sourceid = '0000022731_00-787682463_00-456795041') or (taskid = 20037 and sourceid = '0000000047_00-452309537_0-1328658626') or (taskid = 21155 and sourceid = '0000000080_001621923243_0-2095037864') or (taskid = 21270 and sourceid = '0000000032_0-1535255329_00-185864400') or (taskid = 21684 and sourceid = '0000000021_00-106786337_000639658644') or (taskid = 24027 and sourceid = '0000000087_001460289613_001990510888') or (taskid = 24702 and sourceid = '0000001800_001456317160_0-1357888506') or (taskid = 25065 and sourceid = '0000000089_0-1922811741_001263423164') or (taskid = 25140 and sourceid = '0000000046_00-612884577_0-1631044071') or (taskid = 25359 and sourceid = '0000000033_0-1341112079_0-2015674108') or (taskid = 25484 and sourceid = '0000000159_00-454563471_0-1981362688') or (taskid = 25828 and sourceid = '0000000048_00-262665733_00-892757106') or (taskid = 26798 and sourceid = '0000000112_001995660142_000518885731') or (taskid = 27238 and sourceid = '0000006878_0-1753943070_000386084178') or (taskid = 27569 and sourceid = '0000001834_00-266701999_000343873054') or (taskid = 28857 and sourceid = '0000000151_000232244173_000886643484') or (taskid = 28987 and sourceid = '0000001375_0-1356356766_00-455947993') or (taskid = 29436 and sourceid = '0000002553_0-1640097645_0-1581765376') or (taskid = 32593 and sourceid = '0000000783_00-168171903_00-738723581') or (taskid = 32757 and sourceid = '0000000052_00-138877345_0-1833308525') or (taskid = 35370 and sourceid = '0000000150_00-107648684_000937353199') or (taskid = 38730 and sourceid = '0000000097_00-571047175_0-1920713826') or (taskid = 41659 and sourceid = '0000001470_002116287870_001054958845') or (taskid = 42790 and sourceid = '0000000051_0-1623968275_00-825344286') or (taskid = 54682 and sourceid = '0000000699_000125478136_00-595011983') or (taskid = 54682 and sourceid = '0000000714_0-1442712577_0-1178896760') or (taskid = 59311 and sourceid = '0000000122_001742906312_000182708579') or (taskid = 59640 and sourceid = '0000000088_0-1742179740_000729529658') or (taskid = 59829 and sourceid = '0000028450_00-346018533_000158541296') or (taskid = 60100 and sourceid = '0000001139_000199091235_0-1568203921') or (taskid = 60493 and sourceid = '0000000142_0-1621856090_001426537127') or (taskid = 62426 and sourceid = '0000000062_0-1907497987_000706969310') or (taskid = 63293 and sourceid = '0000000071_0-2145998323_001354617931') or (taskid = 63306 and sourceid = '0000000124_000273037693_001383272350') or (taskid = 63306 and sourceid = '0000000256_000005442244_0-2087938448') or (taskid = 64139 and sourceid = '0000000649_000120576142_001296249253') or (taskid = 64278 and sourceid = '0000000122_000840812407_000182708579') or (taskid = 66905 and sourceid = '0000007208_00-811902318_001526491890') or (taskid = 67192 and sourceid = '0000000006_000582979054_0-1849429213') or (taskid = 67231 and sourceid = '0000000102_001462196251_001938995092') or (taskid = 67238 and sourceid = '0000000086_001211505917_000784962455') or (taskid = 67289 and sourceid = '0000010349_0-1846072388_0-1707891129') or (taskid = 67297 and sourceid = '0000006525_001425844944_00-159681789') or (taskid = 67457 and sourceid = '0000006704_0-1702434194_001084208643') or (taskid = 68707 and sourceid = '0000028450_00-346018533_000158541296') or (taskid = 68766 and sourceid = '0000029091_001632806969_000738324524'))

	union
	select 'Failed' as 'State', projectid, taskid, sourceid, enginestartedon, enginefinishedon, serverid from failedscans
	where 
	
		((taskid = 12303 and sourceid = '0000000050_00-319958211_00-374117344') or (taskid = 1246 and sourceid = '0000000098_000551171435_001158411825') or (taskid = 1252 and sourceid = '0000000046_000507160708_000327549968') or (taskid = 12699 and sourceid = '0000004359_001124553559_001027931664') or (taskid = 12771 and sourceid = '0000000053_001647134862_0-1664125545') or (taskid = 1321 and sourceid = '0000000056_0-1857079141_0-2129327925') or (taskid = 13218 and sourceid = '0000000042_00-680051026_0-1368343568') or (taskid = 13219 and sourceid = '0000000096_000555290107_0-1891124284') or (taskid = 13221 and sourceid = '0000000068_001453830513_001200355202') or (taskid = 13267 and sourceid = '0000000150_001492167418_000762586295') or (taskid = 13751 and sourceid = '0000000152_00-155008502_001619270863') or (taskid = 14801 and sourceid = '0000000079_001341859137_0-1607497417') or (taskid = 15671 and sourceid = '0000000067_0-1817521073_00-271722450') or (taskid = 17233 and sourceid = '0000000211_001064708963_00-166701739') or (taskid = 19895 and sourceid = '0000022731_00-787682463_00-456795041') or (taskid = 20037 and sourceid = '0000000047_00-452309537_0-1328658626') or (taskid = 21155 and sourceid = '0000000080_001621923243_0-2095037864') or (taskid = 21270 and sourceid = '0000000032_0-1535255329_00-185864400') or (taskid = 21684 and sourceid = '0000000021_00-106786337_000639658644') or (taskid = 24027 and sourceid = '0000000087_001460289613_001990510888') or (taskid = 24702 and sourceid = '0000001800_001456317160_0-1357888506') or (taskid = 25065 and sourceid = '0000000089_0-1922811741_001263423164') or (taskid = 25140 and sourceid = '0000000046_00-612884577_0-1631044071') or (taskid = 25359 and sourceid = '0000000033_0-1341112079_0-2015674108') or (taskid = 25484 and sourceid = '0000000159_00-454563471_0-1981362688') or (taskid = 25828 and sourceid = '0000000048_00-262665733_00-892757106') or (taskid = 26798 and sourceid = '0000000112_001995660142_000518885731') or (taskid = 27238 and sourceid = '0000006878_0-1753943070_000386084178') or (taskid = 27569 and sourceid = '0000001834_00-266701999_000343873054') or (taskid = 28857 and sourceid = '0000000151_000232244173_000886643484') or (taskid = 28987 and sourceid = '0000001375_0-1356356766_00-455947993') or (taskid = 29436 and sourceid = '0000002553_0-1640097645_0-1581765376') or (taskid = 32593 and sourceid = '0000000783_00-168171903_00-738723581') or (taskid = 32757 and sourceid = '0000000052_00-138877345_0-1833308525') or (taskid = 35370 and sourceid = '0000000150_00-107648684_000937353199') or (taskid = 38730 and sourceid = '0000000097_00-571047175_0-1920713826') or (taskid = 41659 and sourceid = '0000001470_002116287870_001054958845') or (taskid = 42790 and sourceid = '0000000051_0-1623968275_00-825344286') or (taskid = 54682 and sourceid = '0000000699_000125478136_00-595011983') or (taskid = 54682 and sourceid = '0000000714_0-1442712577_0-1178896760') or (taskid = 59311 and sourceid = '0000000122_001742906312_000182708579') or (taskid = 59640 and sourceid = '0000000088_0-1742179740_000729529658') or (taskid = 59829 and sourceid = '0000028450_00-346018533_000158541296') or (taskid = 60100 and sourceid = '0000001139_000199091235_0-1568203921') or (taskid = 60493 and sourceid = '0000000142_0-1621856090_001426537127') or (taskid = 62426 and sourceid = '0000000062_0-1907497987_000706969310') or (taskid = 63293 and sourceid = '0000000071_0-2145998323_001354617931') or (taskid = 63306 and sourceid = '0000000124_000273037693_001383272350') or (taskid = 63306 and sourceid = '0000000256_000005442244_0-2087938448') or (taskid = 64139 and sourceid = '0000000649_000120576142_001296249253') or (taskid = 64278 and sourceid = '0000000122_000840812407_000182708579') or (taskid = 66905 and sourceid = '0000007208_00-811902318_001526491890') or (taskid = 67192 and sourceid = '0000000006_000582979054_0-1849429213') or (taskid = 67231 and sourceid = '0000000102_001462196251_001938995092') or (taskid = 67238 and sourceid = '0000000086_001211505917_000784962455') or (taskid = 67289 and sourceid = '0000010349_0-1846072388_0-1707891129') or (taskid = 67297 and sourceid = '0000006525_001425844944_00-159681789') or (taskid = 67457 and sourceid = '0000006704_0-1702434194_001084208643') or (taskid = 68707 and sourceid = '0000028450_00-346018533_000158541296') or (taskid = 68766 and sourceid = '0000029091_001632806969_000738324524'))
		) as data;


select ttst.* 
from 
	(select distinct ttst1.taskid, ttst1.sourceid, (select max(enginestartedon) from #TempTaskSourceTable ttst2 where ttst2.taskid = ttst1.taskid and ttst2.SourceId = ttst1.SourceId) as 'Last Scan Date' 
	from #TempTaskSourceTable ttst1) as data
left join
	#TempTaskSourceTable ttst on ttst.taskid = data.taskid and ttst.SourceId = data.SourceId and ttst.EngineStartedOn = data.[Last Scan Date]
order by enginestartedon asc
;
drop table #TempTaskSourceTable;
